from BrandrdXMusic import app 
import asyncio
import random
from pyrogram import Client, filters
from pyrogram.enums import ChatType, ChatMemberStatus
from pyrogram.errors import UserNotParticipant
from pyrogram.types import ChatPermissions

spam_chats = []

# ูุงุฆูุฉ ุงูุฅูููุฌู (ุณูุชู ุงุฎุชูุงุฑ ูุงุญุฏ ุนุดูุงุฆู ููู ุฑุฏ)
MY_EMOJIS = ["๐ง", "๐ค", "๐ค", "๐", "๐"]

# ูุงุฆูุฉ ุงูุฑุฏูุฏ ุงููุฒุฎุฑูุฉ ุจุงููุดูุฏุฉ (ุงูุชุทููู)
TAGMES = [
    " **ูููููุฑูู ุงููุฌูุฑูุจ ููุง ุญููููููู** ",
    " **ููููู ุงููุญูุงู ุนูุณูุงููู ุจูุฎูููุฑ** ",
    " **ููุณูุงุก ุงูููุฑุฏ ูุงููููุงุณูููููู ุนูููููููู** ",
    " **ุตูุจูุงุญ ุงููุฎูููุฑ ูุงููุณูุฑูุฑ** ",
    " **ุงููููู ููุณูุนูุฏ ุฃูููุงุชูููู ุฌูููููุนูุงู** ",
    " **ููุงูููุง ูุงููููู ุจูุงููุบูุงููููู** ",
    " **ุตููููุง ุนูููู ุงููููุจูู** ",
    " **ุฃุชูููููู ููููู ูููู ุฌูููููู ูููุทูููู** ",
    " **ูููููููู ููุฎูุชูููููููู ุทููููููููุง ุนูููููู** ",
    " **ุดูุฑููุชููููุง ููููุฑุชููููุง ูุงููููู** ",
    " **ุนูุณูุงููุง ููุง ููููุญูุฑู ููู ููุงููููุฉ ุงููุญููููุฉ** ",
    " **ุงููููู ุตูุงุญูู ููุฌูู ููุณููููู ุดููู** ",
    " **ูุฌููุฏููู ููู ุงููููู ููุญูููู ุงููุฌูุฑูุจ** ",
    " **ุฃุฎูุจูุงุฑููู ููุง ุทูููุจููููุ** ",
    " **ููููููู ุฏููููููุฉ ููู ูููุชูููู ุงููุญููููุ** ",
    " **ุณูุจูุญูุงู ุงููููู ูุจูุญูููุฏู** ",
    " **ุงุถูุญููููุง ุนูุณูู ุงููุถูุญูููุฉ ููุง ุชูููุงุฑููููู** ",
    " **ููุณูุนูุฏ ููููุจูููู ูููู ููุง ููููุชููุง** ",
    " **ุชูุญูููุงุชูู ููููู ููุฑุฏ ููุฑุฏ** ",
    " **ููุง ููุฑุญูุจ ุชูุฑุงุญูููุจ ุงููููุทูุฑ** ",
    " **ูุด ููุงููููุฏูุก.. ุณูููุนููููุง ุตููุชูููู** ",
    " **ูููููููู ุณูุนูููุฏ ุจูุฅุฐู ุงููููู** ",
    " **ูููุง ุจูุงููููู ููููู ููู ุงููููููุจ ููุนูุฒุฉ** ",
    " **ููููู ุงููุฏุฑุงุณูุฉ/ุงููุดูุบูู ููุนููููุ** ",
    " **ููุง ุดูุงุก ุงููููู ุงููุฌูุฑูุจ ูููููุฑ ุจูุฃููููู** ",
    " **ููุจูู ุชูููุงุนูู ูุญูููุงุณ ูููููููู** ",
    " **ุงุณูุชูุบูููุฑ ุงููููู ุงููุนูุธูููู ูุงุชููุจ ุงููููู** ",
    " **ุนูุณูู ุฃููุงููููู ููููููุง ููุฑุญ** ",
    " **ููุง ุจูุฎูุชูููุง ุจููุฌููุฏููู ููุนูููุง** ",
    " **ูููููุฑููู ุงููุดูุงุช ููุง ุฃููุงุจูุฑ** ",
    " **ุญูุฏ ููุจูู ูููููุฉ ููุง ููุณููู ุดูุงูุ** ",
    " **ูุง ุฅ ููู ุฅ ูุง ุงููููู** ",
    " **ููู ุงููุบููุง ููููู** ",
    " **ููุณูุงุฆูููู ุฑุงุญูุฉ ุจูุงู** ",
    " **ุตูุจูุงุญูููู ุชูููุงุคู ูุฃููู** ",
    " **ุงููููู ููุญูููุธูููู ููู ููู ุดูุฑ** ",
    " **ูููู ุงููููุงุณ ุงููุฑุงููููุฉุ** ",
    " **ุทูุงุจูุช ุฃูููุงุชูููู ุจูููู ุฎูููุฑ** ",
    " **ูููุง ุจูุงููุฒููู ููููู** ",
    " **ูููุฑุชููุง ููุง ููุจูุฏุนูููู** ",
    " **ุฌูุนูู ุงููุณูุนูุงุฏุฉ ููุง ุชูููุงุฑู ูุฌูููููููู** ",
    " **ูุด ุฑุงููููู ููุณูููุน ุดูู ุฑุงูููุ** ",
    " **ุญูููุงููู ุงููููู ุฌูููููุนูุงู** ",
    " **ููุง ูููุง ูุบููุง ุจูุงูููููุฌููุฏููู** ",
    " **ููููู ุงููููุนููููููุงุช ุงููููููุ** ",
    " **ุนูุณูุงููู ุฏูู ููุฑุชูุงุญูููู** ",
    " **ููุง ุฒููู ุณููุงููููููู ูุง ุชูุณูููุชููู** ",
    " **ุฌูููุนูุฉ ุทูููุจูุฉ (ุงุฐุง ููุงู ุงูููููู ุฌูููุนูุฉ)** ",
    " **ุชูููุจูู ุงููููู ุทูุงุนูุชูููู** ",
    " **ููุณูุงุก ุงููุฑุถูุง ูุงููุนูุงููููุฉ** ",
    " **ุตูุจูุงุญูููู ุณูููุฑ** ",
    " **ุฑุจูู ูููููููููู ูููุณูุนูุฏููู** ",
    " **ูููููุฑ ููุง ุบูุงููู/ุบูุงููููุฉ** ",
    " **ุฃุญูููู ุชูุญูููุฉ ูุฃุญูููู ุฃุนูุถูุงุก** ",
    " **ูุด ุฌูุฏููุฏููู ุงููููููุ** ",
    " **ุฎููููููุง ููุบูููุฑ ุฌูู ุดููู** ",
    " **ุฏููุชูู ุจูุฎูููุฑ ูุณูุนูุงุฏุฉ** ",
    " **ููุง ูููุง ูุงููููู ููููููููู ุบููุง** ",
    " **ุงูููููููุจ ุนูููุฏ ุจูุนูุถูููุง** ",
    " **ุงููููู ููุฌูุนูููููู ููู ุงููุณูุนูุฏุงุก** ",
    " **ููุณูุงุฆูููู ููู ูููุงุณูููููู** ",
    " **ุตูุจูุงุญูููู ููุนูุทูุฑ ุจูุฐููุฑ ุงููููู** ",
    " **ููุง ูููุง ุจูุงููููู ุญูุถูุฑ** ",
    " **ูููุฑุชููุง ุงููุฏุงุฑ** ",
    " **ุงููููู ูุง ููุถูุฑููู** ",
    " **ุนูุณูู ุงููุถูุญูููุฉ ุฏูู ููู ูููู** ",
    " **ุดูุงุฑูููููุง ุงููุญูุฏููุซ** ",
    " **ููุง ูููุง ุจูุงููุทูููุจูููู** ",
    " **ููุณูุงููู ุงููููู ุจูุงููุฎูููุฑ** ",
    " **ุตูุจูุญูููู ุงููููู ุจูุงููุฎูููุฑ** ",
    " **ูููุง ุจูุงููููู ุทูููุชูููู ุบูููุฑ** ",
    " **ุญูููุง ุงููููู ุงููุฌูููููุน** ",
    " **ููุชูุดูุฑู ุจููุฌููุฏููู** ",
    " **ุฑุจูู ููุณูุนูุฏ ููุงูููุฌููู** ",
    " **ุทููููููููุง ููููู ุงููุฏููููุง ููุนูููู** ",
    " **ุฃุฌูููู ุชูุฑุญูููุจ ููููุญููููููู** ",
    " **ููุง ุญูู ุงููููู ููู ุฌูุงููุง** ",
    " **ุงุณูุนูุฏ ุงููููู ููุณูุงุฆูููู** ",
    " **ุงุณูุนูุฏ ุงููููู ุตูุจูุงุญูููู** ",
    " **ูููููุฑููู ููุง ููุฌููู ุงููุฌูุฑูุจ** ",
]

@app.on_message(filters.command(["tagall", "all", "ุชุงู", "ููุดู", "ุชูุฌูู", "ุงููู"], prefixes=["/", "@", ".", "#", ""]))
async def mentionall(client, message):
    chat_id = message.chat.id
    if message.chat.type == ChatType.PRIVATE:
        return await message.reply("ูุฐุง ุงูุฃูุฑ ูุนูู ูู ุงููุฌููุนุงุช ููุท.")

    is_admin = False
    try:
        participant = await client.get_chat_member(chat_id, message.from_user.id)
    except UserNotParticipant:
        is_admin = False
    else:
        if participant.status in (
            ChatMemberStatus.ADMINISTRATOR,
            ChatMemberStatus.OWNER
        ):
            is_admin = True
    if not is_admin:
        return await message.reply("ุฃูุช ูุณุช ูุดุฑูุงู ูุง ุนุฒูุฒูุ ูุฐุง ุงูุฃูุฑ ูููุดุฑููู ููุท.")

    # ุงูุชุญูู ูู ุงููุฏุฎูุงุช ููุจุฏุก
    if message.reply_to_message and message.text:
        return await message.reply("ุงูุชุจ (ุชุงู) ุฃู (ููุดู) ููุจุฏุก.")
    elif message.text:
        mode = "text_on_cmd"
        msg = message.text
    elif message.reply_to_message:
        mode = "text_on_reply"
        msg = message.reply_to_message
        if not msg:
            return await message.reply("ุงูุชุจ (ุชุงู) ุฃู (ููุดู) ููุจุฏุก.")
    else:
        return await message.reply("ุงูุชุจ (ุชุงู) ุฃู (ููุดู) ููุจุฏุก.")
    
    if chat_id in spam_chats:
        return await message.reply("ุชูุฌุฏ ุนูููุฉ ุชุงู ุดุบุงูุฉ ุญุงููุงูุ ุงูุชุธุฑ ุฃู ุฃููููุง ุฃููุงู.")
    
    spam_chats.append(chat_id)
    usrnum = 0
    usrtxt = ""
    async for usr in client.get_chat_members(chat_id):
        if not chat_id in spam_chats:
            break
        if usr.user.is_bot:
            continue
        usrnum += 1
        usrtxt += "<a href='tg://user?id={}'>{}</a>".format(usr.user.id, usr.user.first_name)

        if usrnum == 1:
            # ุงุฎุชูุงุฑ ุฅูููุฌู ุนุดูุงุฆู
            chosen_emoji = random.choice(MY_EMOJIS)
            # ุฏูุฌ ุงูุฌููุฉ ุงููุฒุฎุฑูุฉ ูุน ุงูุฅูููุฌู
            txt = f"{usrtxt} {random.choice(TAGMES)} {chosen_emoji}"
            
            if mode == "text_on_cmd":
                await client.send_message(chat_id, txt)
            elif mode == "text_on_reply":
                await msg.reply(txt)
            
            await asyncio.sleep(4) 
            usrnum = 0
            usrtxt = ""
            
    try:
        spam_chats.remove(chat_id)
    except:
        pass


@app.on_message(filters.command(["tagoff", "tagstop", "ุจุณ ุชุงู", "ุงููุงู ุงูุชุงู", "ุจุณ ููุดู", "cancel"]))
async def cancel_spam(client, message):
    if not message.chat.id in spam_chats:
        return await message.reply("ูุง ุชูุฌุฏ ุนูููุฉ ุชุงู ุดุบุงูุฉ ุญุงููุงู.")
    
    is_admin = False
    try:
        participant = await client.get_chat_member(message.chat.id, message.from_user.id)
    except UserNotParticipant:
        is_admin = False
    else:
        if participant.status in (
            ChatMemberStatus.ADMINISTRATOR,
            ChatMemberStatus.OWNER
        ):
            is_admin = True
    if not is_admin:
        return await message.reply("ุฃูุช ูุณุช ูุดุฑูุงู ูุฅููุงู ุงูููุดู.")
    else:
        try:
            spam_chats.remove(message.chat.id)
        except:
            pass
        return await message.reply("ุชูู ุฅููููุงู ุงููุชูุงู ูุงููููููุดูู ุจูููุฌูุงุญ ๐ง")
