from pyrogram import filters
from pyrogram.types import Message

from BrandrdXMusic import app
from BrandrdXMusic.misc import SUDOERS

# [CORE MIGRATION] ุงุณุชูุฑุงุฏ ุงูุฏูุงู ูู ูุณุงุฑ ุงูููุฑ ุงูุฌุฏูุฏ
from BrandrdXMusic.core.database import autoend_off, autoend_on

@app.on_message(filters.command(["autoend", "ุงููุงุก"], prefixes=["", "/", "!", "."]) & SUDOERS)
async def auto_end_stream(client, message: Message):
    # ุฑุณุงูุฉ ุงูุชูุถูุญ (ุจุงููุบุฉ ุงูุนุฑุจูุฉ ููุท)
    usage = (
        "๐ฅ **ุทูุฑููููุฉ ุงูุงุณูุชูุฎูุฏุงู :**\n\n"
        "ููุฌูุจ ุชุญูุฏููุฏ ุงููุญูุงููุฉ (ุชูุนูู ุฃู ุชุนุทูู) ุจูุฌูุงููุจ ุงูุฃููุฑ.\n\n"
        "**ููุซูุงู ููููุชูููุนูููู:**\n"
        "<code>ุงููุงุก ุชููุงุฆู ุชูุนูู</code>\n\n"
        "**ููุซูุงู ููููุชูุนูุทูููู:**\n"
        "<code>ุงููุงุก ุชููุงุฆู ุชุนุทูู</code>"
    )
    
    # ุฌูุจ ูุต ุงูุฑุณุงูุฉ ุจุงููุงูู ูุชุญูููู ูุญุฑูู ุตุบูุฑุฉ ูุชุณููู ุงูุจุญุซ
    full_text = message.text.lower() if message.text else ""
    
    # --- ุญุงูุฉ ุงูุชูุนูู ---
    if "enable" in full_text or "ุชูุนูู" in full_text:
        await autoend_on()
        await message.reply_text(
            "โฅ๏ธ **ุชูู ุชูููุนูููู ููุธูุงู ุงููููุบูุงุฏุฑุฉ ุงููุชูููููุงุฆูููุฉ.**\n\n"
            "๐ง ุณููููููู ุงููุญูุณูุงุจ ุงููููุณูุงุนูุฏ ุจูููุบูุงุฏุฑุฉ ุงููููุญูุงุฏุซูุฉ ุงููุตููุชูููุฉ ุชูููููุงุฆูููุงู ุจูุนูุฏ 3 ุฏููุงุฆูู "
            "ููู ุนูุฏู ูุฌููุฏ ุฃู ุดูุฎูุต ููู ุงููููููุงููููุฉ.\n"
            "๐ **ููุฐุง ุงูุฅุนูุฏุงุฏ ุดูุงููู ููููุงููุฉ ุงููููุฌููููุนูุงุช.**"
        )
        
    # --- ุญุงูุฉ ุงูุชุนุทูู ---
    elif "disable" in full_text or "ุชุนุทูู" in full_text:
        await autoend_off()
        await message.reply_text(
            "๐ฅ **ุชูู ุชูุนูุทูููู ููุธูุงู ุงููููุบูุงุฏุฑุฉ ุงููุชูููููุงุฆูููุฉ.**\n\n"
            "๐ ููู ููุบูุงุฏุฑ ุงููุญูุณูุงุจ ุงููููุณูุงุนูุฏ ุงููููุญูุงุฏุซูุฉ ุฃุจูุฏุงู ุญูุชูู ููู ููุงููุช ููุงุฑุบูุฉ "
            "ุฅูุง ุฅุฐุง ุชูู ุทูุฑุฏู ุฃู ุฅููููุงุก ุงููููููุงููููุฉ ููุฏูููุงู."
        )
        
    # --- ุนูุฏ ูุชุงุจุฉ ุงูุฃูุฑ ุจุฏูู ุญุงูุฉ ---
    else:
        await message.reply_text(usage)
